metadata:
  title: 03_safe_refactor
  source: .cursor/prompts/03_safe_refactor.md
  source_type: markdown
  converted_by: Universal Document to YAML Converter
  format_version: "2.0"
content:
  sections[18]:
    - title: # Safe Refactoring Template
      content[2]: "**Context**: Use this template for restructuring code while maintaining functionality and avoiding breaking changes.","---"
      subsections[0]:
    - title: ## Pre-Refactor Checklist
      content[7]: "Before starting, ensure:","- [ ] All existing tests pass","- [ ] Feature branch created (not working on main)","- [ ] Backup/checkpoint available","- [ ] Clear understanding of current behavior","- [ ] Success criteria defined","---"
      subsections[0]:
    - title: ## Refactoring Request
      content[2]: "**Target Code**: @code:[FILE_PATH]:[LINE_RANGE]","**Objective**: [DESCRIBE THE REFACTORING GOAL]"
      subsections[0]:
    - title: "Examples:"
      content[4]: "- \"Extract validation logic into a separate, testable function\"","- \"Split this class following single responsibility principle\"","- \"Remove duplication by creating a shared utility\"","---"
      subsections[0]:
    - title: ## Constraints
      content[0]:
      subsections[0]:
    - title: "**CRITICAL**:"
      content[10]: "- Maintain backward compatibility with existing API","- Do not change external behavior","- Keep changes minimal and focused","- One logical change at a time","**Forbidden**:","- Changing function signatures without updating all callers","- Removing or renaming public interfaces","- Combining refactor with new features","- Modifying files outside the refactoring scope","---"
      subsections[0]:
    - title: ## Implementation Steps
      content[0]:
      subsections[0]:
    - title: 1. **Analyze Dependencies**
      content[3]: "- Identify all callers of the code being refactored","- Map the dependency graph","- Note any external contracts"
      subsections[0]:
    - title: 2. **Write Characterization Tests** (if missing)
      content[2]: "- Capture current behavior in tests","- These tests must pass before and after refactoring"
      subsections[0]:
    - title: 3. **Execute Refactoring**
      content[3]: "- Make one small change at a time","- Run tests after each change","- Review diff before applying"
      subsections[0]:
    - title: 4. **Validate**
      content[4]: "- All tests pass","- No unintended changes","- Performance not degraded","---"
      subsections[0]:
    - title: ## Output Format
      content[1]: ```markdown
      subsections[0]:
    - title: ## Refactoring Summary
      content[0]:
      subsections[0]:
    - title: ### Changes Made
      content[2]: "- [File 1]: [Description of change]","- [File 2]: [Description of change]"
      subsections[0]:
    - title: ### Tests Updated
      content[1]: "- [Test file]: [Reason for update]"
      subsections[0]:
    - title: ### API Compatibility
      content[2]: "- [x] All public interfaces unchanged","- [x] All callers updated (if signature changed)"
      subsections[0]:
    - title: ### Verification
      content[4]: "- [x] All tests pass","- [x] Manual verification of [key behavior]",```,"---"
      subsections[0]:
    - title: ## Success Criteria
      content[5]: "- [ ] Existing tests continue to pass","- [ ] No breaking changes to public API","- [ ] Code is cleaner/more maintainable","- [ ] Changes are minimal and focused","- [ ] Documentation updated if needed"
      subsections[0]:
  raw_text: "# Safe Refactoring Template\n\n**Context**: Use this template for restructuring code while maintaining functionality and avoiding breaking changes.\n\n---\n\n## Pre-Refactor Checklist\n\nBefore starting, ensure:\n- [ ] All existing tests pass\n- [ ] Feature branch created (not working on main)\n- [ ] Backup/checkpoint available\n- [ ] Clear understanding of current behavior\n- [ ] Success criteria defined\n\n---\n\n## Refactoring Request\n\n**Target Code**: @code:[FILE_PATH]:[LINE_RANGE]\n\n**Objective**: [DESCRIBE THE REFACTORING GOAL]\n\nExamples:\n- \"Extract validation logic into a separate, testable function\"\n- \"Split this class following single responsibility principle\"\n- \"Remove duplication by creating a shared utility\"\n\n---\n\n## Constraints\n\n**CRITICAL**:\n- Maintain backward compatibility with existing API\n- Do not change external behavior\n- Keep changes minimal and focused\n- One logical change at a time\n\n**Forbidden**:\n- Changing function signatures without updating all callers\n- Removing or renaming public interfaces\n- Combining refactor with new features\n- Modifying files outside the refactoring scope\n\n---\n\n## Implementation Steps\n\n1. **Analyze Dependencies**\n   - Identify all callers of the code being refactored\n   - Map the dependency graph\n   - Note any external contracts\n\n2. **Write Characterization Tests** (if missing)\n   - Capture current behavior in tests\n   - These tests must pass before and after refactoring\n\n3. **Execute Refactoring**\n   - Make one small change at a time\n   - Run tests after each change\n   - Review diff before applying\n\n4. **Validate**\n   - All tests pass\n   - No unintended changes\n   - Performance not degraded\n\n---\n\n## Output Format\n\n```markdown\n## Refactoring Summary\n\n### Changes Made\n- [File 1]: [Description of change]\n- [File 2]: [Description of change]\n\n### Tests Updated\n- [Test file]: [Reason for update]\n\n### API Compatibility\n- [x] All public interfaces unchanged\n- [x] All callers updated (if signature changed)\n\n### Verification\n- [x] All tests pass\n- [x] Manual verification of [key behavior]\n```\n\n---\n\n## Success Criteria\n- [ ] Existing tests continue to pass\n- [ ] No breaking changes to public API\n- [ ] Code is cleaner/more maintainable\n- [ ] Changes are minimal and focused\n- [ ] Documentation updated if needed\n\n"
analysis:
  keywords[48]: Objective,Characterization,Clear,Identify,Tests,REFACTORING,Execute,Success,Template,Split,Before,Implementation,These,Performance,CRITICAL,Removing,Capture,DESCRIBE,Code,Extract,Safe,Steps,Note,Request,Target,Refactor,Output,Examples,Maintain,Backup,Changing,Modifying,Write,Constraints,Feature,Review,Dependencies,Refactoring,Validate,GOAL,Remove,Forbidden,Checklist,Keep,Context,Combining,Analyze,Make
  patterns[0]:
  best_practices[1]: not change external behavior
  examples[1]: "- \"Extract validation logic into a separate, testable function\""